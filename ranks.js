const axios = require('axios');
const pips = "https://steam.live.bhvrdbd.com/api/v1/ranks/pips" // "https://latest.dev.bhvrdbd.com/api/v1"
const UserAgent = "DeadByDaylight/++DeadByDaylight+Live-CL-329560 Windows/10.0.19041.1.256.64bit"

// <!---------------------------------------!>
const killerRank = 1 
const survivorRank = 1
const bhvrSession = "bhvrSession="
// <!---------------------------------------!>

var body = {
    survivorPips: 2,
    killerPips: 2,
    forceReset: true
}


function GetRank(pips){
    if (pips < 6) {
        return 20 - Math.floor(pips / 3)
    }
    if (pips < 30) {
        return 18 - Math.floor((pips - 6) / 4)
    }
    return 12 - Math.floor((pips - 30) / 5)
}

function GetPips(rank){
    if (rank > 18){
        return Math.floor((20 - rank) * 3)
    }
    if (rank > 12){
        return Math.floor((18 - rank) * 4) + 6
    }
    return Math.floor((12 - rank) * 5) + 30
}

const killerPips = GetPips(killerRank)
const survivorPips = GetPips(survivorRank)

function loop(){
    axios({method: "PUT", url: pips, data: body, headers: {'Cookie': bhvrSession, 'User-Agent': UserAgent }}).then(response => {
        curKillerPips = response.data.killerPips
        curSurvivorPips = response.data.survivorPips
        console.log('Survivor: ', GetRank(curSurvivorPips), " Killer: ", GetRank(curKillerPips))
        body.killerPips = killerPips - curKillerPips <= 0 ? 0 : 2
        body.survivorPips = survivorPips - curSurvivorPips <= 0 ? 0 : 2
        if (body.killerPips || body.survivorPips ){
            loop()
        }
    }).catch(error => {
        console.log(error.response.data.message)
    }) 
}

loop()